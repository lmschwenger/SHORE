{% extends "base.html" %}

{% block title %}{{ app_name }} - Sentinel Image Explorer{% endblock %}

{% block head_extra %}
<style>
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
    }
    
    .content-container {
        padding: 0;
        height: calc(100vh - 56px - 56px); /* Subtract navbar and footer heights */
    }
    
    #map-container {
        height: 100%;
        position: relative;
    }
    
    #map {
        height: 100%;
        width: 100%;
    }
    
    .sidebar {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 350px;
        max-height: calc(100% - 20px);
        background: white;
        padding: 15px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0,0,0,0.2);
        overflow-y: auto;
        z-index: 1000;
    }

    .image-item {
        transition: transform 0.2s ease-in-out;
    }

    .image-item:hover {
        transform: translateY(-3px);
    }

    .image-preview img {
        cursor: pointer;
        max-height: 200px;
        width: 100%;
        object-fit: cover;
    }
</style>
<!-- Add Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
{% endblock %}

{% block content %}
<div id="map-container">
    <div id="map"></div>

    <div class="sidebar">
        <h2>{{ app_name }}</h2>
        <p>{{ app_description }}</p>

        <div class="accordion mb-3" id="searchAccordion">
            <!-- Area Selection Panel -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="areaHeading">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#areaCollapse" aria-expanded="true" aria-controls="areaCollapse">
                        Area Selection
                    </button>
                </h2>
                <div id="areaCollapse" class="accordion-collapse collapse show" aria-labelledby="areaHeading">
                    <div class="accordion-body">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="geometryType" id="drawOption" value="draw" checked>
                            <label class="form-check-label" for="drawOption">
                                Draw polygon on map
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="geometryType" id="importOption" value="import">
                            <label class="form-check-label" for="importOption">
                                Import polygon
                            </label>
                        </div>

                        <div id="drawInstructions" class="alert alert-info mt-2 small">
                            <p class="mb-0">Use the draw tools in the top-left corner.</p>
                        </div>

                        <div id="importOptions" style="display: none; margin-top: 10px;">
                            <div class="mb-2">
                                <select class="form-select form-select-sm" id="fileFormat">
                                    <option value="geojson">GeoJSON</option>
                                    <option value="shp">Shapefile</option>
                                    <option value="gpkg">GeoPackage</option>
                                </select>
                            </div>
                            <div class="mb-2">
                                <input type="file" class="form-control form-control-sm" id="fileInput">
                            </div>
                            <div class="mb-2">
                                <p class="text-center small">- OR -</p>
                                <textarea class="form-control form-control-sm" id="wktInput" placeholder="Paste WKT here" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Date Range Panel -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="dateHeading">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#dateCollapse" aria-expanded="true" aria-controls="dateCollapse">
                        Date Range
                    </button>
                </h2>
                <div id="dateCollapse" class="accordion-collapse collapse show" aria-labelledby="dateHeading">
                    <div class="accordion-body">
                        <div class="row g-2">
                            <div class="col-6">
                                <label for="dateFrom" class="form-label small">From:</label>
                                <input type="date" class="form-control form-control-sm" id="dateFrom">
                            </div>
                            <div class="col-6">
                                <label for="dateTo" class="form-label small">To:</label>
                                <input type="date" class="form-control form-control-sm" id="dateTo">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters Panel -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="filtersHeading">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#filtersCollapse" aria-expanded="true" aria-controls="filtersCollapse">
                        Filters
                    </button>
                </h2>
                <div id="filtersCollapse" class="accordion-collapse collapse show" aria-labelledby="filtersHeading">
                    <div class="accordion-body">
                        <div class="mb-3">
                            <label for="cloudCoverage" class="form-label d-flex justify-content-between">
                                <span>Max. Cloud Coverage:</span>
                                <span id="cloudCoverageValue">20</span>%
                            </label>
                            <input type="range" class="form-range" min="0" max="100" value="20" id="cloudCoverage">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <button id="searchButton" class="btn btn-primary w-100 mb-4">
            <i class="bi bi-search"></i> Search for Images
        </button>

        <div id="results" style="display: none;">
            <h3>Available Images</h3>
            <div id="imagesList"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/map.js') }}"></script>
{% endblock %}